From 4049fade28e68602bae6d17b3607bb3cd52d7157 Mon Sep 17 00:00:00 2001
From: Rainer Hochecker <fernetmenta@online.de>
Date: Sun, 2 Nov 2014 14:07:37 +0100
Subject: [PATCH] videorefclock: fix potential segfault on systems which do not
 support video sync

---
 xbmc/video/VideoReferenceClock.cpp | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/xbmc/video/VideoReferenceClock.cpp b/xbmc/video/VideoReferenceClock.cpp
index 03f8bf3..be6be5f 100644
--- a/xbmc/video/VideoReferenceClock.cpp
+++ b/xbmc/video/VideoReferenceClock.cpp
@@ -152,9 +152,13 @@ void CVideoReferenceClock::Process()
     SingleLock.Leave();
 
     //clean up the vblank clock
-    m_pVideoSync->Cleanup();
-    delete m_pVideoSync;
-    m_pVideoSync = NULL;
+    if (m_pVideoSync)
+    {
+      m_pVideoSync->Cleanup();
+      delete m_pVideoSync;
+      m_pVideoSync = NULL;
+    }
+
     if (!SetupSuccess)
       break;
   }
